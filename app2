from openai import OpenAI
import streamlit as st

import os
import streamlit as st
from openai import OpenAI
if "messages" not in st.session_state:
    st.session_state.messages = [
        {
            "role": "system",
            "content": (
                "ë„ˆëŠ” ë§¤ìš° ë¬´ëšëší•˜ê³  ë¶ˆì¹œì ˆí•œ ìƒë‹´ê°€ë‹¤. "
                "ì§ˆë¬¸ì— ê°„ê²°í•˜ê³  ì§ì„¤ì ìœ¼ë¡œ, ê·€ì°®ì€ ë“¯ì´ ë‹µí•´. "
                "ì¡´ëŒ“ë§ì€ ì“°ì§€ ë§ê³ , ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ ë§í•´."
            )
        }
    ]
# --- ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ---
PASSWORD = "daeun"

# ì¸ì¦ ìƒíƒœ ì €ì¥
if "authenticated" not in st.session_state:
    st.session_state.authenticated = False

# ì¸ì¦ì´ ì•ˆ ëœ ê²½ìš° ë¡œê·¸ì¸ í™”ë©´ë§Œ ë³´ì—¬ì¤Œ
if not st.session_state.authenticated:
    st.title("ğŸ” í‰í™”ê°€ ì œì¼ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì˜ ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”~")
    password = st.text_input("ì˜ì–´ë¡œ ë‹¤ì„¯ê¸€ì ìœ¼í•˜í•˜ íŒíŠ¸ë¥¼ ì£¼ìë©´ ìµœì”¨ì…ë‹ˆë‹¤! dë¡œ ì‹œì‘í•´ìš”!", type="password")
    if st.button("í‰í™”ë´‡ ì‚¬ìš©í•˜ê¸°"):
        if password == PASSWORD:
            st.session_state.authenticated = True
            st.success("ìœ¼í•˜í•˜!")
            st.rerun()
        else:
            st.error("ì•„ë‹Œë°, ë‹¤ì€ì¸ë°")
    st.stop() 
st.title("ë¶ˆì¹œì ˆí•œ í‰í™”ë´‡")

client = OpenAI()

if "openai_model" not in st.session_state:
    st.session_state["openai_model"] = "gpt-4.1"

if "messages" not in st.session_state:
    st.session_state.messages = []

for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

if prompt := st.chat_input("ì¹œì ˆí•˜ê²Œ ëŒ€ë‹µí•´ë“œë¦½ë‹ˆë‹¤ëŒì¥"):
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    with st.chat_message("assistant"):
        stream = client.chat.completions.create(
            model=st.session_state["openai_model"],
            messages=[
                {"role": m["role"], "content": m["content"]}
                for m in st.session_state.messages
            ],
            stream=True,
        )
        response = st.write_stream(stream)
    st.session_state.messages.append({"role": "assistant", "content": response})
